# WireGuard configuration for {{ wireguard_iface }}
# This config defines a local WireGuard interface and one or more peers.
# The interface will be assigned the IP address from wg_address and will use the generated private key.
# Each Peer section configures a remote endpoint to which this VM will connect.
#
# Address: the IP assigned on the WireGuard device for this VM.
# ListenPort: the UDP port WireGuard listens on locally.
# PrivateKey: the private key for this VM (populated from the generated key).
#
# Peer.PublicKey: the remote peer's public key.
# Peer.Endpoint: the remote peer address:port.
# AllowedIPs: which IP ranges should be routed to the peer.
# PersistentKeepalive: keepalive packets to maintain NAT mappings for the connection.
[Interface]
Address = {{ wg_address }}
ListenPort = {{ listen_port }}
PrivateKey = {{ wg_private_key }}

{% if peers is defined and peers | length > 0 %}
{% for peer in peers %}
[Peer]
PublicKey = {{ peer.pub_key }}
{% if peer.endpoint is defined %}
Endpoint = {{ peer.endpoint }}:{{ peer.port | default(listen_port) }}
{% endif %}
{% if peer.allowed_ips is defined %}
AllowedIPs = {{ peer.allowed_ips }}
{% endif %}
{% if peer.persistent_keepalive is defined %}
PersistentKeepalive = {{ peer.persistent_keepalive | default(persistent_keepalive | default(25)) }}
{% endif %}
{% endfor %}
{% endif %}
